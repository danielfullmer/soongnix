{ android_test, filegroup, java_library }:
let

# ########################################################################
#  Build FrameworksServicesTests package
# ########################################################################

FrameworksServicesTests = android_test {
    name = "FrameworksServicesTests";

    #  Include all test java files.
    srcs = [
        "src/com/android/server/BackgroundRestrictedAlarmsTest.java"
        "src/com/android/server/BatteryServiceTest.java"
        "src/com/android/server/BinderCallsStatsServiceTest.java"
        "src/com/android/server/BootReceiverFixFsckFsStatTest.java"
        "src/com/android/server/CachedDeviceStateServiceTest.java"
        "src/com/android/server/CertBlacklisterTest.java"
        "src/com/android/server/CountryDetectorServiceTest.java"
        "src/com/android/server/DropBoxTest.java"
        "src/com/android/server/DynamicSystemServiceTest.java"
        "src/com/android/server/EntropyMixerTest.java"
        "src/com/android/server/GestureLauncherServiceTest.java"
        "src/com/android/server/MountServiceTests.java"
        "src/com/android/server/NativeDaemonConnectorTest.java"
        "src/com/android/server/NetworkManagementInternalTest.java"
        "src/com/android/server/NetworkScoreServiceTest.java"
        "src/com/android/server/NetworkScorerAppManagerTest.java"
        "src/com/android/server/StorageManagerServiceTest.java"
        "src/com/android/server/ThreadPriorityBoosterTest.java"
        "src/com/android/server/Vector3Test.java"
        "src/com/android/server/WatchdogDiagnosticsTest.java"
        "src/com/android/server/accessibility/AccessibilityGestureDetectorTest.java"
        "src/com/android/server/accessibility/AccessibilityInputFilterTest.java"
        "src/com/android/server/accessibility/AccessibilityManagerTest.java"
        "src/com/android/server/accessibility/AccessibilityServiceConnectionTest.java"
        "src/com/android/server/accessibility/ActionReplacingCallbackTest.java"
        "src/com/android/server/accessibility/FingerprintGestureControllerTest.java"
        "src/com/android/server/accessibility/FingerprintGestureDispatcherTest.java"
        "src/com/android/server/accessibility/GestureDescriptionTest.java"
        "src/com/android/server/accessibility/GlobalActionPerformerTest.java"
        "src/com/android/server/accessibility/KeyEventDispatcherTest.java"
        "src/com/android/server/accessibility/KeyboardInterceptorTest.java"
        "src/com/android/server/accessibility/MagnificationControllerTest.java"
        "src/com/android/server/accessibility/MagnificationGestureHandlerTest.java"
        "src/com/android/server/accessibility/MessageCapturingHandler.java"
        "src/com/android/server/accessibility/MotionEventInjectorTest.java"
        "src/com/android/server/accessibility/TouchExplorerTest.java"
        "src/com/android/server/accessibility/UiAutomationManagerTest.java"
        "src/com/android/server/accounts/AccountAuthenticatorDummyActivity.java"
        "src/com/android/server/accounts/AccountManagerServiceTest.java"
        "src/com/android/server/accounts/AccountManagerServiceTestFixtures.java"
        "src/com/android/server/accounts/AccountsDbTest.java"
        "src/com/android/server/accounts/PreNTestDatabaseHelper.java"
        "src/com/android/server/accounts/TestAccountType1Authenticator.java"
        "src/com/android/server/accounts/TestAccountType1AuthenticatorService.java"
        "src/com/android/server/accounts/TestAccountType2Authenticator.java"
        "src/com/android/server/accounts/TestAccountType2AuthenticatorService.java"
        "src/com/android/server/adb/AdbDebuggingManagerTest.java"
        "src/com/android/server/adb/AdbDebuggingManagerTestActivity.java"
        "src/com/android/server/am/ActivityManagerInternalTest.java"
        "src/com/android/server/am/ActivityManagerServiceTest.java"
        "src/com/android/server/am/ActivityManagerTest.java"
        "src/com/android/server/am/AppErrorDialogTest.java"
        "src/com/android/server/am/BroadcastRecordTest.java"
        "src/com/android/server/am/CoreSettingsObserverTest.java"
        "src/com/android/server/am/MemoryStatUtilTest.java"
        "src/com/android/server/am/OomAdjusterTests.java"
        "src/com/android/server/am/ProcessRecordTests.java"
        "src/com/android/server/am/UserControllerTest.java"
        "src/com/android/server/appop/AppOpsActiveWatcherTest.java"
        "src/com/android/server/appop/AppOpsNotedWatcherTest.java"
        "src/com/android/server/appop/AppOpsUpgradeTest.java"
        "src/com/android/server/appwidget/AppWidgetServiceImplTest.java"
        "src/com/android/server/appwidget/DummyAppWidget.java"
        "src/com/android/server/attention/AttentionManagerServiceTest.java"
        "src/com/android/server/audio/AudioDeviceBrokerTest.java"
        "src/com/android/server/autofill/AutofillManagerServiceTest.java"
        "src/com/android/server/backup/BackupPasswordManagerTest.java"
        "src/com/android/server/backup/DataChangedJournalTest.java"
        "src/com/android/server/backup/ProcessedPackagesJournalTest.java"
        "src/com/android/server/backup/TrampolineTest.java"
        "src/com/android/server/backup/restore/PerformAdbRestoreTaskTest.java"
        "src/com/android/server/backup/testutils/PackageManagerStub.java"
        "src/com/android/server/backup/utils/AppBackupUtilsTest.java"
        "src/com/android/server/backup/utils/BackupManagerMonitorUtilsTest.java"
        "src/com/android/server/backup/utils/BackupObserverUtilsTest.java"
        "src/com/android/server/backup/utils/DataStreamFileCodecTest.java"
        "src/com/android/server/backup/utils/FileUtilsTest.java"
        "src/com/android/server/backup/utils/FullBackupRestoreObserverUtilsTest.java"
        "src/com/android/server/backup/utils/FullBackupUtilsTest.java"
        "src/com/android/server/backup/utils/RandomAccessFileUtilsTest.java"
        "src/com/android/server/backup/utils/SparseArrayUtilsTest.java"
        "src/com/android/server/backup/utils/TarBackupReaderTest.java"
        "src/com/android/server/content/ObserverNodeTest.java"
        "src/com/android/server/content/SyncManagerTest.java"
        "src/com/android/server/content/SyncOperationTest.java"
        "src/com/android/server/contentsuggestions/ContentSuggestionsPerUserServiceTest.java"
        "src/com/android/server/devicepolicy/DevicePolicyConstantsTest.java"
        "src/com/android/server/devicepolicy/DevicePolicyEventLoggerTest.java"
        "src/com/android/server/devicepolicy/DevicePolicyManagerServiceMigrationTest.java"
        "src/com/android/server/devicepolicy/DevicePolicyManagerServiceTestable.java"
        "src/com/android/server/devicepolicy/DevicePolicyManagerTest.java"
        "src/com/android/server/devicepolicy/DevicePolicyManagerTestable.java"
        "src/com/android/server/devicepolicy/DpmMockContext.java"
        "src/com/android/server/devicepolicy/DpmTestBase.java"
        "src/com/android/server/devicepolicy/DpmTestUtils.java"
        "src/com/android/server/devicepolicy/DummyDeviceAdmins.java"
        "src/com/android/server/devicepolicy/MockSystemServices.java"
        "src/com/android/server/devicepolicy/MockUtils.java"
        "src/com/android/server/devicepolicy/NetworkEventTest.java"
        "src/com/android/server/devicepolicy/OverlayPackagesProviderTest.java"
        "src/com/android/server/devicepolicy/OwnersTest.java"
        "src/com/android/server/devicepolicy/SecurityEventTest.java"
        "src/com/android/server/devicepolicy/SystemUpdatePolicyTest.java"
        "src/com/android/server/devicepolicy/TransferOwnershipMetadataManagerTest.java"
        "src/com/android/server/display/AmbientBrightnessStatsTrackerTest.java"
        "src/com/android/server/display/AutomaticBrightnessControllerTest.java"
        "src/com/android/server/display/BrightnessMappingStrategyTest.java"
        "src/com/android/server/display/BrightnessTrackerTest.java"
        "src/com/android/server/display/DisplayManagerServiceTest.java"
        "src/com/android/server/display/PersistentDataStoreTest.java"
        "src/com/android/server/display/TestUtils.java"
        "src/com/android/server/display/color/AppSaturationControllerTest.java"
        "src/com/android/server/display/color/ColorDisplayServiceTest.java"
        "src/com/android/server/display/color/DisplayWhiteBalanceTintControllerTest.java"
        "src/com/android/server/display/color/GlobalSaturationTintControllerTest.java"
        "src/com/android/server/display/whitebalance/AmbientFilterTest.java"
        "src/com/android/server/display/whitebalance/AmbientLuxTest.java"
        "src/com/android/server/display/whitebalance/AmbientSensorTest.java"
        "src/com/android/server/hdmi/ArcInitiationActionFromAvrTest.java"
        "src/com/android/server/hdmi/ArcTerminationActionFromAvrTest.java"
        "src/com/android/server/hdmi/DetectTvSystemAudioModeSupportActionTest.java"
        "src/com/android/server/hdmi/FakeNativeWrapper.java"
        "src/com/android/server/hdmi/HdmiCecControllerTest.java"
        "src/com/android/server/hdmi/HdmiCecLocalDeviceAudioSystemTest.java"
        "src/com/android/server/hdmi/HdmiCecLocalDevicePlaybackTest.java"
        "src/com/android/server/hdmi/HdmiCecLocalDeviceTest.java"
        "src/com/android/server/hdmi/HdmiCecMessageBuilderTest.java"
        "src/com/android/server/hdmi/HdmiControlServiceTest.java"
        "src/com/android/server/hdmi/HdmiUtilsTest.java"
        "src/com/android/server/hdmi/SystemAudioInitiationActionFromAvrTest.java"
        "src/com/android/server/input/ConfigurationProcessorTest.java"
        "src/com/android/server/inputmethod/InputMethodManagerServiceTests.java"
        "src/com/android/server/inputmethod/InputMethodSubtypeSwitchingControllerTest.java"
        "src/com/android/server/inputmethod/InputMethodUtilsTest.java"
        "src/com/android/server/inputmethod/LocaleUtilsTest.java"
        "src/com/android/server/job/BackgroundRestrictionsTest.java"
        "src/com/android/server/job/JobCountTrackerTest.java"
        "src/com/android/server/job/JobSetTest.java"
        "src/com/android/server/job/JobStoreTest.java"
        "src/com/android/server/job/MaxJobCountsTest.java"
        "src/com/android/server/job/MockPriorityJobService.java"
        "src/com/android/server/job/PrioritySchedulingTest.java"
        "src/com/android/server/location/ComprehensiveCountryDetectorTest.java"
        "src/com/android/server/location/CustomCountryDetectorTestClass.java"
        "src/com/android/server/location/LocationBasedCountryDetectorTest.java"
        "src/com/android/server/location/LocationRequestStatisticsTest.java"
        "src/com/android/server/locksettings/BaseLockSettingsServiceTests.java"
        "src/com/android/server/locksettings/CachedSyntheticPasswordTests.java"
        "src/com/android/server/locksettings/FakeGateKeeperService.java"
        "src/com/android/server/locksettings/FakeGsiService.java"
        "src/com/android/server/locksettings/FakeStorageManager.java"
        "src/com/android/server/locksettings/LockSettingsServiceTestable.java"
        "src/com/android/server/locksettings/LockSettingsServiceTests.java"
        "src/com/android/server/locksettings/LockSettingsShellCommandTest.java"
        "src/com/android/server/locksettings/LockSettingsStorageTestable.java"
        "src/com/android/server/locksettings/LockSettingsStorageTests.java"
        "src/com/android/server/locksettings/MockLockSettingsContext.java"
        "src/com/android/server/locksettings/MockSyntheticPasswordManager.java"
        "src/com/android/server/locksettings/MockWeaverService.java"
        "src/com/android/server/locksettings/PasswordSlotManagerTestable.java"
        "src/com/android/server/locksettings/PasswordSlotManagerTests.java"
        "src/com/android/server/locksettings/SP800DeriveTests.java"
        "src/com/android/server/locksettings/SyntheticPasswordTests.java"
        "src/com/android/server/locksettings/WeaverBasedSyntheticPasswordTests.java"
        "src/com/android/server/locksettings/recoverablekeystore/KeySyncTaskTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/KeySyncUtilsTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/MockScrypt.java"
        "src/com/android/server/locksettings/recoverablekeystore/PlatformKeyManagerTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/RecoverableKeyGeneratorTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/RecoverableKeyStoreManagerTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/RecoverySnapshotListenersStorageTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/SecureBoxTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/TestData.java"
        "src/com/android/server/locksettings/recoverablekeystore/TestOnlyInsecureCertificateHelperTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/WrappedKeyTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/certificate/CertUtilsTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/certificate/CertXmlTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/certificate/SigXmlTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/certificate/TestData.java"
        "src/com/android/server/locksettings/recoverablekeystore/serialization/KeyChainSnapshotSerializerTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/storage/CleanupManagerTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/storage/RecoverableKeyStoreDbHelperTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/storage/RecoverableKeyStoreDbTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/storage/RecoverySessionStorageTest.java"
        "src/com/android/server/locksettings/recoverablekeystore/storage/RecoverySnapshotStorageTest.java"
        "src/com/android/server/net/ConnOnActivityStartTest.java"
        "src/com/android/server/net/IpConfigStoreTest.java"
        "src/com/android/server/net/NetworkPolicyManagerServiceTest.java"
        "src/com/android/server/net/watchlist/HarmfulDigestsTests.java"
        "src/com/android/server/net/watchlist/NetworkWatchlistServiceTests.java"
        "src/com/android/server/net/watchlist/PrivacyUtilsTests.java"
        "src/com/android/server/net/watchlist/ReportEncoderTests.java"
        "src/com/android/server/net/watchlist/WatchlistConfigTests.java"
        "src/com/android/server/net/watchlist/WatchlistLoggingHandlerTests.java"
        "src/com/android/server/net/watchlist/WatchlistSettingsTests.java"
        "src/com/android/server/om/OverlayManagerServiceImplTests.java"
        "src/com/android/server/om/OverlayManagerSettingsTests.java"
        "src/com/android/server/pm/BaseShortcutManagerTest.java"
        "src/com/android/server/pm/CrossProfileAppsServiceImplTest.java"
        "src/com/android/server/pm/InstallerTest.java"
        "src/com/android/server/pm/KeySetManagerServiceTest.java"
        "src/com/android/server/pm/KeySetStrings.java"
        "src/com/android/server/pm/KeySetUtils.java"
        "src/com/android/server/pm/ModuleInfoProviderTest.java"
        "src/com/android/server/pm/PackageInstallerSessionTest.java"
        "src/com/android/server/pm/PackageManagerServiceTest.java"
        "src/com/android/server/pm/PackageManagerSettingsTests.java"
        "src/com/android/server/pm/PackageParserTest.java"
        "src/com/android/server/pm/PackageSignaturesTest.java"
        "src/com/android/server/pm/PackageUserStateTest.java"
        "src/com/android/server/pm/PackageVerificationStateTest.java"
        "src/com/android/server/pm/ParallelPackageParserTest.java"
        "src/com/android/server/pm/ShortcutManagerTest1.java"
        "src/com/android/server/pm/ShortcutManagerTest10.java"
        "src/com/android/server/pm/ShortcutManagerTest2.java"
        "src/com/android/server/pm/ShortcutManagerTest3.java"
        "src/com/android/server/pm/ShortcutManagerTest4.java"
        "src/com/android/server/pm/ShortcutManagerTest5.java"
        "src/com/android/server/pm/ShortcutManagerTest6.java"
        "src/com/android/server/pm/ShortcutManagerTest7.java"
        "src/com/android/server/pm/ShortcutManagerTest8.java"
        "src/com/android/server/pm/ShortcutManagerTest9.java"
        "src/com/android/server/pm/ShortcutTestActivity.java"
        "src/com/android/server/pm/SuspendDialogInfoTest.java"
        "src/com/android/server/pm/SuspendPackagesTest.java"
        "src/com/android/server/pm/SuspendedDetailsActivity.java"
        "src/com/android/server/pm/UserDataPreparerTest.java"
        "src/com/android/server/pm/UserLifecycleStressTest.java"
        "src/com/android/server/pm/UserManagerServiceCreateProfileTest.java"
        "src/com/android/server/pm/UserManagerServiceIdRecyclingTest.java"
        "src/com/android/server/pm/UserManagerServiceTest.java"
        "src/com/android/server/pm/UserManagerServiceUserInfoTest.java"
        "src/com/android/server/pm/UserManagerTest.java"
        "src/com/android/server/pm/UserRestrictionsUtilsTest.java"
        "src/com/android/server/pm/backup/BackupUtilsTest.java"
        "src/com/android/server/pm/dex/DexManagerTests.java"
        "src/com/android/server/pm/dex/DexoptOptionsTests.java"
        "src/com/android/server/pm/dex/DexoptUtilsTest.java"
        "src/com/android/server/pm/dex/DynamicCodeLoggerTests.java"
        "src/com/android/server/pm/dex/PackageDexUsageTests.java"
        "src/com/android/server/pm/dex/PackageDynamicCodeLoadingTests.java"
        "src/com/android/server/power/AttentionDetectorTest.java"
        "src/com/android/server/power/PowerManagerServiceTest.java"
        "src/com/android/server/power/ThermalManagerServiceTest.java"
        "src/com/android/server/power/batterysaver/BatterySaverPolicyTest.java"
        "src/com/android/server/power/batterysaver/BatterySavingStatsTest.java"
        "src/com/android/server/power/batterysaver/CpuFrequenciesTest.java"
        "src/com/android/server/power/batterysaver/FileUpdaterTest.java"
        "src/com/android/server/rollback/AppDataRollbackHelperTest.java"
        "src/com/android/server/search/SearchablesTest.java"
        "src/com/android/server/signedconfig/SignedConfigTest.java"
        "src/com/android/server/storage/AppCollectorTest.java"
        "src/com/android/server/storage/CacheQuotaStrategyTest.java"
        "src/com/android/server/storage/DiskStatsFileLoggerTest.java"
        "src/com/android/server/storage/DiskStatsLoggingServiceTest.java"
        "src/com/android/server/storage/FileCollectorTest.java"
        "src/com/android/server/textservices/LazyIntToIntMapTest.java"
        "src/com/android/server/textservices/LocaleUtilsTest.java"
        "src/com/android/server/timedetector/SimpleTimeZoneDetectorStrategyTest.java"
        "src/com/android/server/timedetector/TimeDetectorServiceTest.java"
        "src/com/android/server/timedetector/TimeDetectorStrategyTest.java"
        "src/com/android/server/timezone/CheckTokenTest.java"
        "src/com/android/server/timezone/PackageStatusStorageTest.java"
        "src/com/android/server/timezone/PackageStatusTest.java"
        "src/com/android/server/timezone/PackageTrackerTest.java"
        "src/com/android/server/timezone/PackageVersionsTest.java"
        "src/com/android/server/timezone/RulesManagerServiceTest.java"
        "src/com/android/server/twilight/TwilightServiceTest.java"
        "src/com/android/server/updates/CertPinInstallReceiverTest.java"
        "src/com/android/server/usage/AppIdleHistoryTests.java"
        "src/com/android/server/usage/AppStandbyControllerTests.java"
        "src/com/android/server/usage/AppTimeLimitControllerTests.java"
        "src/com/android/server/usage/StorageStatsServiceTest.java"
        "src/com/android/server/usage/UsageStatsDatabaseTest.java"
        "src/com/android/server/utils/PriorityDumpTest.java"
        "src/com/android/server/wallpaper/WallpaperServiceTests.java"
        "src/com/android/server/webkit/TestSystemImpl.java"
        "src/com/android/server/webkit/WebViewUpdateServiceTest.java"

        "aidl/com/android/servicestests/aidl/INetworkStateObserver.aidl"
        "aidl/com/android/servicestests/aidl/ICmdReceiverService.aidl"

        "test-apps/JobTestApp/src/com/android/servicestests/apps/jobtestapp/TestJobActivity.java"
        "test-apps/JobTestApp/src/com/android/servicestests/apps/jobtestapp/TestJobService.java"

        "test-apps/SuspendTestApp/src/com/android/servicestests/apps/suspendtestapp/SuspendTestActivity.java"
        "test-apps/SuspendTestApp/src/com/android/servicestests/apps/suspendtestapp/SuspendTestReceiver.java"
    ];
    static_libs = [
        "frameworks-base-testutils"
        "services.accessibility"
        "services.appwidget"
        "services.autofill"
        "services.backup"
        "services.contentsuggestions"
        "services.core"
        "services.devicepolicy"
        "services.net"
        "services.usage"
        "guava"
        "androidx.test.core"
        "androidx.test.runner"
        "androidx.test.rules"
        "mockito-target-minus-junit4"
        "platform-test-annotations"
        "ShortcutManagerTestUtils"
        "truth-prebuilt"
        "testables"
        "testng"
        "ub-uiautomator"
        "platformprotosnano"
        "hamcrest-library"
        "servicestests-utils"
    ];

    aidl = {
        local_include_dirs = ["aidl"];
    };

    libs = [
        "android.hidl.manager-V1.0-java"
        "android.hardware.tv.cec-V1.0-java"
        "android.test.mock"
        "android.test.base"
        "android.test.runner"
    ];

    platform_apis = true;
    test_suites = ["device-tests"];

    certificate = "platform";

    #  These are not normally accessible from apps so they must be explicitly included.
    jni_libs = [
        "libbacktrace"
        "libbase"
        "libbinder"
        "libbinderthreadstate"
        "libc++"
        "libcutils"
        "liblog"
        "liblzma"
        "libnativehelper"
        "libpsi"
        "libui"
        "libunwindstack"
        "libutils"
        "netd_aidl_interface-V2-cpp"
    ];

    dxflags = ["--multi-dex"];

    optimize = {
        enabled = false;
    };
};

servicestests-utils = java_library {
    name = "servicestests-utils";
    srcs = [
        "utils/com/android/server/testutils/OffsettableClock.java"
        "utils/com/android/server/testutils/TestHandler.java"
        "utils/com/android/server/testutils/TestUtils.java"
    ];
    static_libs = [
        "junit"
        "mockito-target-minus-junit4"
    ];
    libs = [
        "android.test.runner"
    ];
};

servicestests-SuspendTestApp-files = filegroup {
    name = "servicestests-SuspendTestApp-files";
    srcs = [
        "src/com/android/server/pm/SuspendPackagesTest.java"
    ];
};

in { inherit FrameworksServicesTests servicestests-SuspendTestApp-files servicestests-utils; }
