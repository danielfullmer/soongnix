{ android_test, java_library }:
let

#  Copyright (C) 2008 The Android Open Source Project
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

ctsmediautil = java_library {
    name = "ctsmediautil";
    srcs = [
        "src/android/media/cts/CodecImage.java"
        "src/android/media/cts/YUVImage.java"
        "src/android/media/cts/CodecUtils.java"
    ];
    sdk_version = "current";
};

CtsMediaTestCases = android_test {
    name = "CtsMediaTestCases";
    defaults = ["cts_defaults"];
    #  include both the 32 and 64 bit versions
    compile_multilib = "both";
    static_libs = [
        "androidx.test.core"
        "androidx.test.ext.junit"
        "compatibility-device-util-axt"
        "ctsdeviceutillegacy-axt"
        "ctsmediautil"
        "ctstestrunner-axt"
        "hamcrest-library"
        "ctstestserver"
        "junit"
        "junit-params"
        "ndkaudio"
        "testng"
        "truth-prebuilt"
        "mockito-target-minus-junit4"
        "androidx.heifwriter_heifwriter"
    ];
    jni_libs = [
        "libaudio_jni"
        "libctscodecutils_jni"
        "libctsimagereader_jni"
        "libctsmediadrm_jni"
        "libctsmediacodec_jni"
        "libnativehelper_compat_libc++"
        "libndkaudioLib"
    ];
    #  do not compress VP9 video files
    aaptflags = [
        "-0 .vp9"
        "-0 .ts"
        "-0 .heic"
        "-0 .trp"
        "-0 .ota"
        "-0 .mxmf"
    ];
    srcs = [
        "src/android/media/cts/AdaptivePlaybackTest.java"
        "src/android/media/cts/AsyncPlayerTest.java"
        "src/android/media/cts/AudioAttributesTest.java"
        "src/android/media/cts/AudioEffectTest.java"
        "src/android/media/cts/AudioFocusTest.java"
        "src/android/media/cts/AudioFormatTest.java"
        "src/android/media/cts/AudioHelper.java"
        "src/android/media/cts/AudioManagerStub.java"
        "src/android/media/cts/AudioManagerStubHelper.java"
        "src/android/media/cts/AudioManagerTest.java"
        "src/android/media/cts/AudioMetadataTest.java"
        "src/android/media/cts/AudioNativeTest.java"
        "src/android/media/cts/AudioPlayRoutingNative.java"
        "src/android/media/cts/AudioPlaybackCaptureTest.java"
        "src/android/media/cts/AudioPlaybackConfigurationTest.java"
        "src/android/media/cts/AudioPreProcessingTest.java"
        "src/android/media/cts/AudioPresentationTest.java"
        "src/android/media/cts/AudioRecordAppOpTest.java"
        "src/android/media/cts/AudioRecordNative.java"
        "src/android/media/cts/AudioRecordRoutingNative.java"
        "src/android/media/cts/AudioRecordTest.java"
        "src/android/media/cts/AudioRecord_BufferSizeTest.java"
        "src/android/media/cts/AudioRecordingConfigurationTest.java"
        "src/android/media/cts/AudioSystemTest.java"
        "src/android/media/cts/AudioSystemUsageTest.java"
        "src/android/media/cts/AudioTrackLatencyTest.java"
        "src/android/media/cts/AudioTrackNative.java"
        "src/android/media/cts/AudioTrackOffloadTest.java"
        "src/android/media/cts/AudioTrackSurroundTest.java"
        "src/android/media/cts/AudioTrackTest.java"
        "src/android/media/cts/AudioTrack_ListenerTest.java"
        "src/android/media/cts/BassBoostTest.java"
        "src/android/media/cts/CamcorderProfileTest.java"
        "src/android/media/cts/CameraProfileTest.java"
        "src/android/media/cts/CodecImage.java"
        "src/android/media/cts/CodecState.java"
        "src/android/media/cts/CodecUtils.java"
        "src/android/media/cts/CompositionTextureView.java"
        "src/android/media/cts/ConnectionStatus.java"
        "src/android/media/cts/DecodeAccuracyTest.java"
        "src/android/media/cts/DecodeAccuracyTestActivity.java"
        "src/android/media/cts/DecodeAccuracyTestBase.java"
        "src/android/media/cts/DecodeEditEncodeTest.java"
        "src/android/media/cts/DecoderConformanceTest.java"
        "src/android/media/cts/DecoderTest.java"
        "src/android/media/cts/DecoderTestAacDrc.java"
        "src/android/media/cts/DecoderTestAacFormat.java"
        "src/android/media/cts/DecoderTestXheAac.java"
        "src/android/media/cts/DeviceUtils.java"
        "src/android/media/cts/DynamicsProcessingTest.java"
        "src/android/media/cts/EncodeDecodeTest.java"
        "src/android/media/cts/EncodeVirtualDisplayTest.java"
        "src/android/media/cts/EncodeVirtualDisplayWithCompositionTest.java"
        "src/android/media/cts/EncodeVirtualDisplayWithCompositionTestImpl.java"
        "src/android/media/cts/EncoderTest.java"
        "src/android/media/cts/EnumDevicesTest.java"
        "src/android/media/cts/EnvReverbTest.java"
        "src/android/media/cts/EqualizerTest.java"
        "src/android/media/cts/ExifInterfaceTest.java"
        "src/android/media/cts/ExtractDecodeEditEncodeMuxTest.java"
        "src/android/media/cts/FaceDetectorStub.java"
        "src/android/media/cts/FaceDetectorTest.java"
        "src/android/media/cts/FaceDetector_FaceTest.java"
        "src/android/media/cts/FaceView.java"
        "src/android/media/cts/HandlerExecutor.java"
        "src/android/media/cts/HeifWriterTest.java"
        "src/android/media/cts/IConnectionStatus.java"
        "src/android/media/cts/ImageReaderDecoderTest.java"
        "src/android/media/cts/InputSurface.java"
        "src/android/media/cts/InputSurfaceInterface.java"
        "src/android/media/cts/IvfReader.java"
        "src/android/media/cts/IvfWriter.java"
        "src/android/media/cts/JetPlayerTest.java"
        "src/android/media/cts/LocalMediaProjectionService.java"
        "src/android/media/cts/LoudnessEnhancerTest.java"
        "src/android/media/cts/MediaActivityTest.java"
        "src/android/media/cts/MediaBrowserServiceTest.java"
        "src/android/media/cts/MediaBrowserTest.java"
        "src/android/media/cts/MediaButtonReceiver.java"
        "src/android/media/cts/MediaCasTest.java"
        "src/android/media/cts/MediaCodecBlockModelTest.java"
        "src/android/media/cts/MediaCodecCapabilitiesTest.java"
        "src/android/media/cts/MediaCodecClearKeyPlayer.java"
        "src/android/media/cts/MediaCodecListTest.java"
        "src/android/media/cts/MediaCodecPlayerTest.java"
        "src/android/media/cts/MediaCodecPlayerTestBase.java"
        "src/android/media/cts/MediaCodecTest.java"
        "src/android/media/cts/MediaCodecTunneledPlayer.java"
        "src/android/media/cts/MediaCodecWrapper.java"
        "src/android/media/cts/MediaController2Test.java"
        "src/android/media/cts/MediaControllerTest.java"
        "src/android/media/cts/MediaDrmClearkeyTest.java"
        "src/android/media/cts/MediaDrmMetricsTest.java"
        "src/android/media/cts/MediaDrmMockTest.java"
        "src/android/media/cts/MediaDrmTest.java"
        "src/android/media/cts/MediaExtractorTest.java"
        "src/android/media/cts/MediaFormatTest.java"
        "src/android/media/cts/MediaHeavyPresubmitTest.java"
        "src/android/media/cts/MediaItemTest.java"
        "src/android/media/cts/MediaMetadataRetrieverTest.java"
        "src/android/media/cts/MediaMetricsTest.java"
        "src/android/media/cts/MediaMuxerTest.java"
        "src/android/media/cts/MediaPlayerDrmTest.java"
        "src/android/media/cts/MediaPlayerDrmTestBase.java"
        "src/android/media/cts/MediaPlayerFlakyNetworkTest.java"
        "src/android/media/cts/MediaPlayerSurfaceStubActivity.java"
        "src/android/media/cts/MediaPlayerSurfaceTest.java"
        "src/android/media/cts/MediaPlayerTest.java"
        "src/android/media/cts/MediaPlayerTestBase.java"
        "src/android/media/cts/MediaProjectionActivity.java"
        "src/android/media/cts/MediaProjectionTest.java"
        "src/android/media/cts/MediaRandomTest.java"
        "src/android/media/cts/MediaRecorderTest.java"
        "src/android/media/cts/MediaRoute2InfoTest.java"
        "src/android/media/cts/MediaRoute2ProviderServiceTest.java"
        "src/android/media/cts/MediaRouter2Test.java"
        "src/android/media/cts/MediaRouterTest.java"
        "src/android/media/cts/MediaScannerConnectionTest.java"
        "src/android/media/cts/MediaScannerNotificationTest.java"
        "src/android/media/cts/MediaScannerTest.java"
        "src/android/media/cts/MediaSession2ServiceTest.java"
        "src/android/media/cts/MediaSession2Test.java"
        "src/android/media/cts/MediaSessionManagerTest.java"
        "src/android/media/cts/MediaSessionTest.java"
        "src/android/media/cts/MediaSessionTestActivity.java"
        "src/android/media/cts/MediaStubActivity.java"
        "src/android/media/cts/MediaStubActivity2.java"
        "src/android/media/cts/MediaSyncTest.java"
        "src/android/media/cts/MediaTimeProvider.java"
        "src/android/media/cts/MediaTimestampTest.java"
        "src/android/media/cts/MidiSoloTest.java"
        "src/android/media/cts/MockActivity.java"
        "src/android/media/cts/NativeDecoderTest.java"
        "src/android/media/cts/NativeImageReaderTest.java"
        "src/android/media/cts/NativeMediaDrmClearkeyTest.java"
        "src/android/media/cts/NdkInputSurface.java"
        "src/android/media/cts/NdkMediaCodec.java"
        "src/android/media/cts/NonBlockingAudioTrack.java"
        "src/android/media/cts/NonMediaMainlineTest.java"
        "src/android/media/cts/OutputSurface.java"
        "src/android/media/cts/ParamsTest.java"
        "src/android/media/cts/PlaybackStateTest.java"
        "src/android/media/cts/PostProcTestBase.java"
        "src/android/media/cts/PresentationSyncTest.java"
        "src/android/media/cts/PresetReverbTest.java"
        "src/android/media/cts/RemoteControllerTest.java"
        "src/android/media/cts/RemoteVirtualDisplayService.java"
        "src/android/media/cts/ResourceManagerStubActivity.java"
        "src/android/media/cts/ResourceManagerTest.java"
        "src/android/media/cts/ResourceManagerTestActivity1.java"
        "src/android/media/cts/ResourceManagerTestActivity2.java"
        "src/android/media/cts/ResourceManagerTestActivityBase.java"
        "src/android/media/cts/RingtoneManagerTest.java"
        "src/android/media/cts/RingtonePickerActivity.java"
        "src/android/media/cts/RingtoneTest.java"
        "src/android/media/cts/RouteDiscoveryPreferenceTest.java"
        "src/android/media/cts/RoutingSessionInfoTest.java"
        "src/android/media/cts/RoutingTest.java"
        "src/android/media/cts/SafeWaitObject.java"
        "src/android/media/cts/ScannerNotificationReceiver.java"
        "src/android/media/cts/SdkMediaCodec.java"
        "src/android/media/cts/Session2CommandGroupTest.java"
        "src/android/media/cts/Session2CommandTest.java"
        "src/android/media/cts/SoundPoolAacTest.java"
        "src/android/media/cts/SoundPoolHapticTest.java"
        "src/android/media/cts/SoundPoolMidiTest.java"
        "src/android/media/cts/SoundPoolOggTest.java"
        "src/android/media/cts/SoundPoolTest.java"
        "src/android/media/cts/StreamingMediaPlayerTest.java"
        "src/android/media/cts/StubMediaBrowserService.java"
        "src/android/media/cts/StubMediaRoute2ProviderService.java"
        "src/android/media/cts/StubMediaSession2Service.java"
        "src/android/media/cts/SubtitleDataTest.java"
        "src/android/media/cts/SurfaceEncodeTimestampTest.java"
        "src/android/media/cts/TestMediaDataSource.java"
        "src/android/media/cts/TestProxyFileDescriptorCallback.java"
        "src/android/media/cts/TestUtils.java"
        "src/android/media/cts/TextureRender.java"
        "src/android/media/cts/ThumbnailUtilsTest.java"
        "src/android/media/cts/TimedMetaDataTest.java"
        "src/android/media/cts/ToneGeneratorTest.java"
        "src/android/media/cts/Utils.java"
        "src/android/media/cts/UtilsTest.java"
        "src/android/media/cts/VideoCodecTest.java"
        "src/android/media/cts/VideoCodecTestBase.java"
        "src/android/media/cts/VideoDecoderPerfTest.java"
        "src/android/media/cts/VideoDecoderRotationTest.java"
        "src/android/media/cts/VideoEditorTest.java"
        "src/android/media/cts/VideoEncoderTest.java"
        "src/android/media/cts/VideoSurfaceView.java"
        "src/android/media/cts/VirtualizerTest.java"
        "src/android/media/cts/VisualizerTest.java"
        "src/android/media/cts/VolumeShaperTest.java"
        "src/android/media/cts/YUVImage.java"
    ];
    #  This test uses private APIs
    # sdk_version: "current",
    platform_apis = true;
    jni_uses_sdk_apis = true;
    libs = [
        "org.apache.http.legacy"
        "android.test.base.stubs"
        "android.test.runner.stubs"
    ];
    #  Tag this module as a cts test artifact
    test_suites = [
        "cts"
        "vts10"
        "general-tests"
        "mts"
    ];
    host_required = ["cts-dynamic-config"];
    min_sdk_version = "29";
};

in { inherit CtsMediaTestCases ctsmediautil; }
