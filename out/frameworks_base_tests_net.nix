{ android_test, java_defaults }:
let

# ########################################################################
#  Build FrameworksNetTests package
# ########################################################################
FrameworksNetTests-jni-defaults = java_defaults {
    name = "FrameworksNetTests-jni-defaults";
    static_libs = [
        "FrameworksNetCommonTests"
        "frameworks-base-testutils"
        "frameworks-net-testutils"
        "framework-protos"
        "androidx.test.rules"
        "mockito-target-minus-junit4"
        "platform-test-annotations"
        "services.core"
        "services.net"
    ];
    libs = [
        "android.test.runner"
        "android.test.base"
        "android.test.mock"
    ];
    jni_libs = [
        "ld-android"
        "libartbase"
        "libbacktrace"
        "libbase"
        "libbinder"
        "libbinderthreadstate"
        "libbpf"
        "libbpf_android"
        "libc++"
        "libcgrouprc"
        "libcrypto"
        "libcutils"
        "libdexfile"
        "libdl_android"
        "libhidl-gen-utils"
        "libhidlbase"
        "libhidltransport"
        "libhwbinder"
        "libjsoncpp"
        "liblog"
        "liblzma"
        "libnativehelper"
        "libnetdbpf"
        "libnetdutils"
        "libpackagelistparser"
        "libpcre2"
        "libprocessgroup"
        "libselinux"
        "libui"
        "libutils"
        "libvndksupport"
        "libtinyxml2"
        "libunwindstack"
        "libutilscallstack"
        "libziparchive"
        "libz"
        "netd_aidl_interface-V2-cpp"
        "libnetworkstatsfactorytestjni"
    ];
};

FrameworksNetTests = android_test {
    name = "FrameworksNetTests";
    defaults = ["FrameworksNetTests-jni-defaults"];
    srcs = [
        "java/android/app/usage/NetworkStatsManagerTest.java"
        "java/android/net/ConnectivityManagerTest.java"
        "java/android/net/DnsPacketTest.java"
        "java/android/net/IpMemoryStoreTest.java"
        "java/android/net/IpSecAlgorithmTest.java"
        "java/android/net/IpSecConfigTest.java"
        "java/android/net/IpSecManagerTest.java"
        "java/android/net/IpSecTransformTest.java"
        "java/android/net/MacAddressTest.java"
        "java/android/net/NetworkStackTest.java"
        "java/android/net/NetworkStatsHistoryTest.java"
        "java/android/net/NetworkStatsTest.java"
        "java/android/net/NetworkUtilsTest.java"
        "java/android/net/TcpKeepalivePacketDataTest.java"
        "java/android/net/UidRangeTest.java"
        "java/android/net/dhcp/DhcpServingParamsParcelExtTest.java"
        "java/android/net/ip/InterfaceControllerTest.java"
        "java/android/net/ip/IpServerTest.java"
        "java/android/net/ipmemorystore/ParcelableTests.java"
        "java/android/net/netlink/ConntrackMessageTest.java"
        "java/android/net/netlink/InetDiagSocketTest.java"
        "java/android/net/netlink/NetlinkErrorMessageTest.java"
        "java/android/net/netlink/NetlinkSocketTest.java"
        "java/android/net/netlink/RtNetlinkNeighborMessageTest.java"
        "java/android/net/nsd/NsdManagerTest.java"
        "java/android/net/nsd/NsdServiceInfoTest.java"
        "java/android/net/shared/Inet4AddressUtilsTest.java"
        "java/android/net/shared/InitialConfigurationTest.java"
        "java/android/net/shared/IpConfigurationParcelableUtilTest.java"
        "java/android/net/shared/ProvisioningConfigurationTest.java"
        "java/android/net/util/DnsUtilsTest.java"
        "java/android/net/util/InterfaceParamsTest.java"
        "java/android/net/util/InterfaceSetTest.java"
        "java/android/net/util/IpUtilsTest.java"
        "java/android/net/util/SharedLogTest.java"
        "java/android/net/util/VersionedBroadcastListenerTest.java"
        "java/com/android/internal/util/BitUtilsTest.java"
        "java/com/android/internal/util/RingBufferTest.java"
        "java/com/android/server/ConnectivityServiceTest.java"
        "java/com/android/server/IpSecServiceParameterizedTest.java"
        "java/com/android/server/IpSecServiceRefcountedResourceTest.java"
        "java/com/android/server/IpSecServiceTest.java"
        "java/com/android/server/NetworkManagementServiceTest.java"
        "java/com/android/server/NsdServiceTest.java"
        "java/com/android/server/connectivity/DnsManagerTest.java"
        "java/com/android/server/connectivity/IpConnectivityEventBuilderTest.java"
        "java/com/android/server/connectivity/IpConnectivityMetricsTest.java"
        "java/com/android/server/connectivity/LingerMonitorTest.java"
        "java/com/android/server/connectivity/MetricsTestUtil.java"
        "java/com/android/server/connectivity/MultipathPolicyTrackerTest.java"
        "java/com/android/server/connectivity/Nat464XlatTest.java"
        "java/com/android/server/connectivity/NetdEventListenerServiceTest.java"
        "java/com/android/server/connectivity/NetworkNotificationManagerTest.java"
        "java/com/android/server/connectivity/PermissionMonitorTest.java"
        "java/com/android/server/connectivity/TetheringTest.java"
        "java/com/android/server/connectivity/VpnTest.java"
        "java/com/android/server/connectivity/tethering/EntitlementManagerTest.java"
        "java/com/android/server/connectivity/tethering/OffloadControllerTest.java"
        "java/com/android/server/connectivity/tethering/TetheringConfigurationTest.java"
        "java/com/android/server/connectivity/tethering/UpstreamNetworkMonitorTest.java"
        "java/com/android/server/net/NetworkStatsAccessTest.java"
        "java/com/android/server/net/NetworkStatsBaseTest.java"
        "java/com/android/server/net/NetworkStatsCollectionTest.java"
        "java/com/android/server/net/NetworkStatsFactoryTest.java"
        "java/com/android/server/net/NetworkStatsObserversTest.java"
        "java/com/android/server/net/NetworkStatsServiceTest.java"
        "java/com/android/server/net/ipmemorystore/NetworkAttributesTest.java"
        "java/android/net/util/KeepaliveUtilsTest.kt"
        "java/com/android/server/LegacyTypeTrackerTest.kt"
    ];
    platform_apis = true;
    test_suites = ["device-tests"];
    certificate = "platform";
};

in { inherit FrameworksNetTests FrameworksNetTests-jni-defaults; }
